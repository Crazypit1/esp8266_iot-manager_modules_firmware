# esp8266 + Iot manager modules firmware
Это модульная прошивка для ESP8266 и приложения IoT Manager. Она позволяет быстро настроить умный дом на базе ESP8266 без программирования.

## Ссылка для скачивания прошивки: [esp8266_iot-manager_modules_firmware](https://github.com/DmitryBorisenko33/esp8266_iot-manager_modules_firmware/releases/download/v1.0.7%2B/esp8266_iot-manager_modules_firmware.zip)

## Ссылка для скачивания IOT manager: [IOT manager](https://github.com/DmitryBorisenko33/esp8266_iot-manager_modules_firmware/raw/master/iot_manager/IoT%20Manager%201.5.5.apk)


1. Модуль управления реле (можно управлять всеми пинами модуля)

2. Модуль физической кнопки (может по нажатию отправлять команды включения выключения реле на другие модули и на этот, а так же отправлять push уведомления)

3. Модуль измерения уровня в баке (поддержка дальномера HC-SR04 или водонепроницаемого JSN-SR04T v2.0, с последним пработал достаточно хорошо, решил проблему с его нестабильностью путем добавления конденсатора на 100 мкф по питанию. Провел исследование и понял что этот дальномер лучше всего работает от 5.5 вольт. В результате получил более 1000 одинаковых измерений на расстоянии 2 метра без фильтров. Но что бы окончательно довести до ума этот датчик решил еще применить медианный фильтр, который отсекает промахи в измерениях. Каждые пол секунды датчик делает замер и так 20 раз. Потом полученные 20 значений анализируются и выбирается одно из них, самое часто встречающиеся.) Думаю модуль измерения воды в баке можно даже теперь применять вместе с насосами и силовыми устройствами. Что кстати можно настроить в сценариях моей прошивки. 

4. Модуль аналогового сенсора это модуль который легко настроить под любой датчик. Задается начальное/конечное значение входное и начальное/конечное значение выходное. Выходное это то которое будет отображаться в приложении. Например если написать входное: 0 - 1024 а выходное 0 - 100 то диапазон от 0 до 1024 масштабируется в значения от 0 до 100. В общем говоря это ардуиновская функция map, кто знает тот поймет. Но очень удобно так аналоговые датчики переводить в нужные диапазоны. При том можно и делать не от нуля. Например от 500 до 1000 перевести к примеру от -50 до 50.)

5. Модуль температурного сенсора ds18b20. Тут все просто - красивый термометр в iot manager появляется. 

6. Модуль управления ШИМ. Можно создавать много на разные пины при том в iot manager появятся ползунки которыми можно будет устанавливать значения.

Сценарии работают так что на любое пороговое значение любого сенсора можно назначить либо команду включения реле на другом устройстве или на этом, либо можно назначить отправку пуш либо все сразу. И пуш и команду. 

Сделал поддержку push уведомлений. Когда перешел на новую среду последней версии все стало работать четко. Правда пока пуши отправляются в pushbullet. Потом восстановим api iot manager будут отправляться и в iot manager. Сделал так, что не отправленные пуши если не было интернета сохраняются в памяти и потом когда интернет появляется они отправляются. 

В общем то переход на новую среду все просто до неузноваемости изменил. Все начало работать очень быстро. В разы быстрее. Я не ожидал сам и памяти всего 40 процентов оперативной занимает. 

Видео подробных инструкций:

[Часть 1 - Как прошить модуль esp8266 ](https://www.youtube.com/watch?v=octnqt9XBAs)

[Часть 2 - Настройка подключения к серверу MQTT (cloudmqtt) ](https://www.youtube.com/watch?v=SXgtQ0zh1RQ)

[Часть 3 - Настройка модуля управления реле ](https://www.youtube.com/watch?v=1aIoAOH7Hms&t)

[Часть 4 - Настройка push уведомлений ](https://www.youtube.com/watch?v=8vzU5YEo9LE)
